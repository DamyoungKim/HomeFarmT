# 포팅 메뉴얼

### .env 파일

---

백엔드

```
DB_DATABASE=iot
DB_USERNAME=root
DB_PASSWORD=ssafy
DB_HOST=52.79.134.74
SECRET_KEY=76DA6F237C6F628FE28BDEFD
```

프론트엔드

```
VUE_APP_GRAPHQL_SEVER=https://j5b201.p.ssafy.io/graphql
VUE_APP_BACKEND_SERVER=https://j5b201.p.ssafy.io/api/
VUE_APP_WEATHER_API=f76e5170ae05649ca6570a9acf9ee65f
```

### 데이터 베이스

---

웹 서버의 3306 포트에 docker 컨테이너로 배포되어 있다

```python
데이터베이스 이름: iot
유저: ssafy
비밀번호: ssafy
호스트: 52.79.134.74
```

ERD

![ERD.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/ERD.png)

### 배포

---

배포는 jenkins에서 JenkinsFile을 gitlab에서 클론받아 사용합니다.

jenkins는 [http://j5b201.p.ssafy.io:8080/](http://j5b201.p.ssafy.io:8080/) 사이트에 있으며 계정: ssafy 비밀번호: ssafy 입니다.

gitlab에서 클론 받은 후 docker compose up을 사용하여

/frontend 경로에 .env 파일을 생성 후

```
npm install --legacy-peer-deps
npm run build
```

/backend 경로에서 .env 파일을 생성합니다.

그 다음 

```
docker-compose down --rmi all
docker-compose up -d
```

위의 명령어를 사용하여 도커 파일을 빌드합니다.

### 외부 서비스

---

OpenWeatherMap API의 API key를 사용합니다. 

```
VUE_APP_WEATHER_API=f76e5170ae05649ca6570a9acf9ee65f
```

### 시연 시나리오

---

![로그인.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EB%A1%9C%EA%B7%B8%EC%9D%B8.png)

메인 페이지입니다. 우측 상단의 아이콘을 클릭하여 로그인 및 회원가입이 가능합니다.

아이디: ssafy@ssafy.com

비밀번호: ssafy

위의 계정을 사용하면 스케쥴과 히스토리의 데이터가 입력되어 있습니다.

![기기제어.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EA%B8%B0%EA%B8%B0%EC%A0%9C%EC%96%B4.png)

![TVcontrolx3_resize.gif](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/TVcontrolx3_resize.gif)

기기제어 페이지에 들어가면 시뮬레이터와 iot_udp.py, data_center.py 파일을 실행하여 원격에서 기기 제어가 가능합니다. (로컬에서만 가능)

![스케쥴.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EC%8A%A4%EC%BC%80%EC%A5%B4.png)

![스케줄 페이지2.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EC%8A%A4%EC%BC%80%EC%A4%84_%ED%8E%98%EC%9D%B4%EC%A7%802.png)

일정 버튼을 클릭하면 스케줄을 관리할 수 있는 페이지가 나옵니다. 날짜에 따라 등록된 스케줄이 표시되고 토글 버튼으로 스케줄의 상태를 데이터 베이스에 저장합니다.

추가 버튼을 눌러 스케줄을 등록할 수 있습니다.

스케줄의 시간표에 따라 python 파일을 실행하여  자동화하는 작업은 미완성 상태입니다.

![감시버튼.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EA%B0%90%EC%8B%9C%EB%B2%84%ED%8A%BC.png)

![감시배속.gif](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%EA%B0%90%EC%8B%9C%EB%B0%B0%EC%86%8D.gif)

메인 페이지의 감시버튼을 클릭하면 설정한 경로로 감시를 실행할 수 있습니다.

감시중에 일어나는 이벤트들 (침입자 발견 시 사진 저장)은 아직 미완성 상태입니다.

![터틀봇조작.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%ED%84%B0%ED%8B%80%EB%B4%87%EC%A1%B0%EC%9E%91.png)

메인페이지의 터틀봇 조작 버튼을 클릭하면, 버튼을 클릭하여 터틀봇을 직접 조작하거나 물건을 들고 놓는 것이 가능합니다.

우측 상단의 맵을 클릭하여 시작과 끝점을 지정해주면 터틀봇이 자동으로 경로를 찾아 주행합니다

시뮬레이터를 작동시킨 다음 data_center.py를 실행 후 sub2_launch.py 를 런치합니다.

![히스토리페이지.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%ED%9E%88%EC%8A%A4%ED%86%A0%EB%A6%AC%ED%8E%98%EC%9D%B4%EC%A7%80.png)

![히스토리.PNG](%E1%84%91%E1%85%A9%E1%84%90%E1%85%B5%E1%86%BC%20%E1%84%86%E1%85%A6%E1%84%82%E1%85%B2%E1%84%8B%E1%85%A5%E1%86%AF%20d97b6cca0afc45b9baddfba5d4bdd6ff/%ED%9E%88%EC%8A%A4%ED%86%A0%EB%A6%AC.png)

메인페이지의 아이콘을 클릭하면 히스토리가 표시됩니다. 터틀봇이 감시를 수행하며 일어난 이벤트들의 데이터를 저장하여 나타냅니다. 아직 미완성 상태입니다.